# AI角色扮演项目 - 多大模型支持配置指南

## 🎯 项目概述

您的AI角色扮演项目现在支持多种大模型服务，包括：
- **智谱AI ChatGLM**（推荐，中文支持优秀）
- **OpenAI GPT-4o**（兼容，需要API密钥）
- **百度语音识别**（语音转文字）
- **浏览器Web Speech API**（语音合成，免费）

## 🔑 API配置选项

### 选项1：智谱AI ChatGLM（推荐）

**优势：**
- 中文支持优秀，特别适合中文角色扮演
- 注册即可获得免费Token额度
- 国内服务，网络稳定

**配置步骤：**
1. 访问 [智谱AI开放平台](https://open.bigmodel.cn/)
2. 注册账号并实名认证
3. 进入控制台创建API密钥
4. 修改 `backend/.env` 文件：
   ```
   ZHIPU_API_KEY=您的智谱AI密钥
   LLM_PROVIDER=zhipu
   ```

### 选项2：OpenAI GPT-4o（可选）

**优势：**
- 全球最先进的大语言模型
- 支持多语言，推理能力强

**配置步骤：**
1. 访问 [OpenAI API平台](https://platform.openai.com/api-keys)
2. 创建API密钥
3. 修改 `backend/.env` 文件：
   ```
   OPENAI_API_KEY=您的OpenAI密钥
   LLM_PROVIDER=openai
   ```

### 选项3：百度语音识别（可选）

**优势：**
- 中文语音识别准确度高
- 注册即有免费额度

**配置步骤：**
1. 访问 [百度AI开放平台](https://ai.baidu.com/)
2. 创建语音技术应用
3. 获取AppID、API Key、Secret Key
4. 修改 `backend/.env` 文件：
   ```
   BAIDU_APP_ID=您的百度AppID
   BAIDU_API_KEY=您的百度API密钥
   BAIDU_SECRET_KEY=您的百度Secret密钥
   ```

## 🚀 快速开始

### 1. 最简配置（使用模拟模式）
如果暂时不想配置API密钥，项目已经内置了智能模拟模式：
- 直接启动项目即可体验完整界面
- AI会根据不同角色返回相应的模拟回复
- 语音功能使用浏览器内置API，完全免费

### 2. 推荐配置（智谱AI + 浏览器语音）
```bash
# 后端配置
cd backend
# 编辑 .env 文件，配置智谱AI密钥
ZHIPU_API_KEY=您的智谱AI密钥
LLM_PROVIDER=zhipu

# 启动服务
python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

```bash
# 前端配置
cd frontend
npm run dev
```

### 3. 完整配置（所有服务）
配置所有API密钥后，享受完整的多模态AI体验：
- 真实的LLM智能对话
- 高质量的语音识别
- 自然的语音合成

## 🎭 角色扮演体验

### 已配置的AI角色

1. **苏格拉底** (socrates)
   - 古希腊哲学家，擅长问答法引导思考
   - 语音特性：语速较慢，音调稍低
   - 对话风格：善于反问，引导深度思考

2. **哈利·波特** (harry)
   - 霍格沃茨魔法学院学生
   - 语音特性：年轻声音，语速正常
   - 对话风格：友善热情，充满想象力

3. **夏洛克·福尔摩斯** (holmes)
   - 著名侦探，逻辑推理专家
   - 语音特性：语速较快，音调理性
   - 对话风格：观察敏锐，逻辑严密

## 🎤 语音功能

### 语音录制
- **权限**: 首次使用需授权麦克风
- **格式**: WebM/Opus，16kHz采样率
- **质量**: 支持回声消除和噪声抑制
- **操作**: 点击麦克风按钮开始/停止录制

### 语音播放
- **引擎**: 浏览器内置Web Speech API
- **支持**: Chrome、Edge、Safari等现代浏览器
- **音色**: 自动根据角色选择合适音色
- **控制**: 每条AI回复都有独立播放按钮

## 🛠️ 开发指南

### 项目结构
```
AI_ROLEPLAY_PROJECT/
├── backend/                 # FastAPI后端
│   ├── app/
│   │   ├── api/            # API路由
│   │   ├── core/           # 核心服务
│   │   │   ├── llm_client.py      # 多大模型客户端
│   │   │   ├── zhipu_client.py    # 智谱AI客户端
│   │   │   └── config.py          # 配置管理
│   │   ├── services/       # 业务服务
│   │   │   ├── chat_servers.py    # 聊天服务
│   │   │   ├── asr.py             # 语音识别
│   │   │   └── baidu_asr.py       # 百度ASR
│   │   └── models/         # 数据模型
│   └── .env               # 环境配置
├── frontend/              # React前端
│   ├── src/
│   │   ├── components/    # React组件
│   │   │   ├── VoiceRecorder.jsx  # 语音录制
│   │   │   ├── AudioPlayer.jsx    # 语音播放
│   │   │   └── ChatBox.jsx        # 聊天界面
│   │   ├── services/      # 前端服务
│   │   │   ├── chat.js           # 聊天API
│   │   │   └── webSpeech.js      # 语音服务
│   │   └── pages/         # 页面组件
│   └── package.json
```

### API接口
- **文本聊天**: `POST /api/chat/text`
- **WebSocket**: `ws://localhost:8000/ws/api/session/{session_id}/{role_id}`
- **语音识别**: `POST /api/chat/asr`
- **语音合成**: `POST /api/chat/tts`

### 技术栈
- **后端**: FastAPI + Python + Pydantic
- **前端**: React 18 + Vite + Tailwind CSS
- **AI服务**: 智谱AI/OpenAI + 百度语音
- **通信**: REST API + WebSocket

## 🔧 故障排除

### 常见问题

1. **LLM无响应**
   - 检查API密钥是否正确配置
   - 确认 `.env` 文件中 `LLM_PROVIDER` 设置
   - 查看后端控制台错误日志

2. **语音录制无权限**
   - 在浏览器地址栏点击锁图标
   - 允许麦克风权限
   - 刷新页面重试

3. **语音播放无声音**
   - 检查浏览器是否支持Web Speech API
   - 确认系统音量设置
   - 尝试不同浏览器

4. **API调用失败**
   - 检查网络连接
   - 确认API密钥额度
   - 查看服务器响应状态码

### 性能优化

1. **降低API成本**
   - 使用智谱AI代替OpenAI（成本更低）
   - 调整对话历史长度限制
   - 优化Prompt设计

2. **提升响应速度**
   - 使用流式API减少感知延迟
   - 启用前端缓存机制
   - 优化网络请求并发

## 🎉 享受您的AI角色扮演体验！

现在您可以：
- 🤖 与三个不同性格的AI角色对话
- 🎙️ 使用语音进行自然交流
- 🔊 听到AI角色的语音回复
- 💬 体验沉浸式的角色扮演

需要技术支持或想要添加新功能，随时联系开发团队！