å¥½çš„ âœ… æˆ‘æ¥å¸®ä½ å†™ä¸€ç‰ˆ**å‰åç«¯éª¨æ¶ä»£ç **ï¼ˆå‰ç«¯ï¼šReact + Vite + Tailwindï¼Œåç«¯ï¼šFastAPI + WebSocketï¼‰ï¼Œå¹¶ä¸”å†™ä¸Š**è¯¦ç»†ä¸­æ–‡æ³¨é‡Š**ï¼Œè¿™æ ·ä½ ç¬¬ä¸€æ¬¡åšå¤§å‹é¡¹ç›®ä¹Ÿèƒ½ç†è§£ã€‚

------

# ä¸€ã€é¡¹ç›®ç›®å½•ç»“æ„ï¼ˆæ¨èï¼‰

```
ai-roleplay-chat/
â”œâ”€â”€ backend/                # åç«¯ä»£ç ç›®å½•
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ main.py         # FastAPI ä¸»å…¥å£
â”‚   â”‚   â”œâ”€â”€ api/            # API è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ chat.py     # èŠå¤©ç›¸å…³æ¥å£ï¼ˆè°ƒç”¨ LLMã€è¯­éŸ³è¯†åˆ«ã€TTSï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ roles.py    # è§’è‰²æœç´¢/ç®¡ç†æ¥å£
â”‚   â”‚   â”œâ”€â”€ core/           # æ ¸å¿ƒé…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ config.py   # å…¨å±€é…ç½®ï¼ˆAPI Keyã€æ¨¡å‹é…ç½®ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ llm_client.py # LLM è°ƒç”¨å·¥å…·
â”‚   â”‚   â”œâ”€â”€ models/         # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ role.py     # è§’è‰²ä¿¡æ¯æ¨¡å‹
â”‚   â”‚   â””â”€â”€ services/       # æœåŠ¡é€»è¾‘
â”‚   â”‚       â”œâ”€â”€ tts.py      # æ–‡æœ¬è½¬è¯­éŸ³æœåŠ¡
â”‚   â”‚       â”œâ”€â”€ asr.py      # è¯­éŸ³è½¬æ–‡æœ¬æœåŠ¡
â”‚   â”‚       â””â”€â”€ chat_service.py # èŠå¤©æœåŠ¡å°è£…
â”‚   â””â”€â”€ requirements.txt    # åç«¯ä¾èµ–
â”‚
â”œâ”€â”€ frontend/               # å‰ç«¯ä»£ç ç›®å½•
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ App.jsx         # React ä¸»å…¥å£
â”‚   â”‚   â”œâ”€â”€ pages/          # é¡µé¢
â”‚   â”‚   â”‚   â””â”€â”€ ChatPage.jsx # èŠå¤©é¡µé¢
â”‚   â”‚   â”œâ”€â”€ components/     # å¯å¤ç”¨ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatBox.jsx # èŠå¤©æ¡†ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ AudioRecorder.jsx # è¯­éŸ³å½•åˆ¶æŒ‰é’®
â”‚   â”‚   â”œâ”€â”€ services/       # API è¯·æ±‚å°è£…
â”‚   â”‚   â”‚   â”œâ”€â”€ api.js      # é€šç”¨è¯·æ±‚å·¥å…·
â”‚   â”‚   â”‚   â””â”€â”€ chat.js     # èŠå¤© API è°ƒç”¨
â”‚   â””â”€â”€ package.json        # å‰ç«¯ä¾èµ–
â”‚
â””â”€â”€ README.md               # é¡¹ç›®è¯´æ˜
```

------

# äºŒã€åç«¯éª¨æ¶ä»£ç ï¼ˆFastAPIï¼‰

ğŸ“Œ `backend/app/main.py`

```
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from app.api import chat, roles

# åˆ›å»º FastAPI åº”ç”¨
app = FastAPI(title="AI è§’è‰²æ‰®æ¼” API")

# é…ç½®è·¨åŸŸ (å…è®¸å‰ç«¯è®¿é—®)
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # å¼€å‘é˜¶æ®µå…è®¸æ‰€æœ‰æ¥æºï¼Œç”Ÿäº§ç¯å¢ƒè¦æ”¹
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# æ³¨å†Œè·¯ç”±
app.include_router(chat.router, prefix="/chat", tags=["Chat"])
app.include_router(roles.router, prefix="/roles", tags=["Roles"])

# å¥åº·æ£€æŸ¥æ¥å£
@app.get("/health")
def health_check():
    return {"status": "ok"}
```

ğŸ“Œ `backend/app/api/chat.py`

```
from fastapi import APIRouter
from pydantic import BaseModel
from app.core.llm_client import call_llm

router = APIRouter()

# è¯·æ±‚ä½“æ¨¡å‹
class ChatRequest(BaseModel):
    role: str   # è§’è‰²åå­—ï¼Œä¾‹å¦‚ "å“ˆåˆ©æ³¢ç‰¹"
    message: str # ç”¨æˆ·è¾“å…¥

class ChatResponse(BaseModel):
    reply: str  # AI å›å¤æ–‡æœ¬

@router.post("/")
def chat(req: ChatRequest):
    """
    èŠå¤©æ¥å£ï¼š
    è¾“å…¥ï¼šè§’è‰² + ç”¨æˆ·æ¶ˆæ¯
    è¾“å‡ºï¼šAI å›å¤æ–‡æœ¬
    """
    reply = call_llm(req.role, req.message)
    return ChatResponse(reply=reply)
```

ğŸ“Œ `backend/app/core/llm_client.py`

```
"""
è¿™é‡Œå°è£… LLM è°ƒç”¨é€»è¾‘ï¼Œå¯ä»¥æ¢æˆ OpenAIã€Deepseek ç­‰ã€‚
æœªæ¥å¦‚æœè¦åˆ‡æ¢æ¨¡å‹ï¼Œåªæ”¹è¿™é‡Œã€‚
"""
def call_llm(role: str, message: str) -> str:
    # æ¨¡æ‹Ÿè°ƒç”¨å¤§æ¨¡å‹æ¥å£
    # TODO: æ›¿æ¢ä¸ºçœŸå® API è¯·æ±‚
    return f"[{role}çš„å›ç­”]ï¼šä½ å¥½ï¼ä½ åˆšæ‰è¯´çš„æ˜¯ '{message}'"
```

------

# ä¸‰ã€å‰ç«¯éª¨æ¶ä»£ç ï¼ˆReactï¼‰

ğŸ“Œ `frontend/src/App.jsx`

```
import { useState } from "react";
import ChatPage from "./pages/ChatPage";

function App() {
  return (
    <div className="h-screen w-screen bg-gray-100 flex items-center justify-center">
      <ChatPage />
    </div>
  );
}

export default App;
```

ğŸ“Œ `frontend/src/pages/ChatPage.jsx`

```
import { useState } from "react";
import ChatBox from "../components/ChatBox";
import { sendChat } from "../services/chat";

function ChatPage() {
  const [messages, setMessages] = useState([]);

  const handleSend = async (text) => {
    // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
    setMessages([...messages, { sender: "user", text }]);

    // è°ƒç”¨åç«¯ API è·å– AI å›å¤
    const res = await sendChat("å“ˆåˆ©æ³¢ç‰¹", text);
    setMessages((prev) => [...prev, { sender: "ai", text: res.reply }]);
  };

  return (
    <div className="w-full max-w-2xl bg-white p-4 rounded shadow-md">
      <h1 className="text-xl font-bold mb-4">AI è§’è‰²æ‰®æ¼”</h1>
      <ChatBox messages={messages} onSend={handleSend} />
    </div>
  );
}

export default ChatPage;
```

ğŸ“Œ `frontend/src/components/ChatBox.jsx`

```
import { useState } from "react";

function ChatBox({ messages, onSend }) {
  const [input, setInput] = useState("");

  const handleSend = () => {
    if (input.trim()) {
      onSend(input);
      setInput("");
    }
  };

  return (
    <div>
      <div className="h-64 overflow-y-auto border p-2 mb-2">
        {messages.map((m, i) => (
          <div key={i} className={m.sender === "user" ? "text-right" : "text-left"}>
            <span
              className={`inline-block p-2 my-1 rounded ${
                m.sender === "user" ? "bg-blue-200" : "bg-green-200"
              }`}
            >
              {m.text}
            </span>
          </div>
        ))}
      </div>
      <div className="flex">
        <input
          className="flex-1 border p-2 rounded-l"
          value={input}
          onChange={(e) => setInput(e.target.value)}
          placeholder="è¾“å…¥æ¶ˆæ¯..."
        />
        <button className="bg-blue-500 text-white px-4 rounded-r" onClick={handleSend}>
          å‘é€
        </button>
      </div>
    </div>
  );
}

export default ChatBox;
```

ğŸ“Œ `frontend/src/services/chat.js`

```
export async function sendChat(role, message) {
  const res = await fetch("http://localhost:8000/chat/", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ role, message }),
  });
  return res.json();
}
```

------

# å››ã€ç¼–è¾‘å™¨ & å¼€å‘ç¯å¢ƒ

- **ç¼–è¾‘å™¨æ¨è**ï¼š

  - **VS Code**ï¼ˆè·¨å¹³å°ã€æ’ä»¶å¤šï¼Œæ¯”å¦‚ REST Client è°ƒè¯• APIï¼ŒTailwind CSS è‡ªåŠ¨è¡¥å…¨ï¼‰
  - æˆ–è€… **PyCharmï¼ˆåç«¯ï¼‰+ WebStormï¼ˆå‰ç«¯ï¼‰** åˆ†å¼€ç®¡ç†

- **è¿è¡Œæ–¹å¼**ï¼š

  1. åç«¯

     ```
     cd backend
     pip install -r requirements.txt
     uvicorn app.main:app --reload
     ```

  2. å‰ç«¯

     ```
     cd frontend
     npm install
     npm run dev
     ```

------

è¦ä¸è¦æˆ‘æ¥ä¸‹æ¥å¸®ä½ å†™ä¸€ä¸ª**è¯¦ç»†çš„å¼€å‘è®¡åˆ’è¡¨**ï¼ˆç¬¬1å‘¨åšå“ªäº›ï¼Œæ€ä¹ˆè·‘èµ·æ¥ï¼Œç¬¬2å‘¨å†åŠ è¯­éŸ³åŠŸèƒ½ï¼Œç¬¬3å‘¨å†åŠ è§’è‰²æŠ€èƒ½ï¼‰ï¼Ÿè¿™æ ·ä½ å°±èƒ½è·Ÿç€æ‰§è¡Œäº†ã€‚

##### 